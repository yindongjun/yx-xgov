webpackJsonp([20],{"/BV2":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"add-or-update-warn-rule-dialog-section"},[a("el-dialog",{attrs:{title:-1==e.isEditRelation.id?"新建报警规则":"修改报警规则",visible:e.addOrUpdateWarnRuleDialogVisible,"before-close":e.closeDialog,"lock-scroll":!1,"close-on-click-modal":!1,width:"500px"},on:{"update:visible":function(t){e.addOrUpdateWarnRuleDialogVisible=t},open:e.open}},[a("el-form",{ref:"addOrUpdateWarnRuleDialogForm",staticClass:"demo-form-inline",attrs:{model:e.addOrUpdateWarnRuleDialogForm,rules:e.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"报警名称: ",prop:"alarmName"}},[a("el-input",{attrs:{maxlength:"128",placeholder:"最大长度为128个字符",size:"small"},model:{value:e.addOrUpdateWarnRuleDialogForm.alarmName,callback:function(t){e.$set(e.addOrUpdateWarnRuleDialogForm,"alarmName",t)},expression:"addOrUpdateWarnRuleDialogForm.alarmName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"报警原因: ",prop:"alarmReasion"}},[a("el-radio-group",{model:{value:e.addOrUpdateWarnRuleDialogForm.alarmReasion,callback:function(t){e.$set(e.addOrUpdateWarnRuleDialogForm,"alarmReasion",t)},expression:"addOrUpdateWarnRuleDialogForm.alarmReasion"}},[a("el-radio",{attrs:{label:"1",name:"warnReason"}},[e._v("完成")]),e._v(" "),a("el-radio",{attrs:{label:"0",name:"warnReason"}},[e._v("失败")]),e._v(" "),a("el-radio",{attrs:{label:"2",name:"warnReason"}},[e._v("完成/失败")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"报警方式: ",prop:"alarmMethod"}},[a("el-radio-group",{model:{value:e.addOrUpdateWarnRuleDialogForm.alarmMethod,callback:function(t){e.$set(e.addOrUpdateWarnRuleDialogForm,"alarmMethod",t)},expression:"addOrUpdateWarnRuleDialogForm.alarmMethod"}},[a("el-radio",{attrs:{label:"1",name:"warnMethod"}},[e._v("邮件")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"接收人: ",prop:"receivePeople"}},[a("el-input",{attrs:{disabled:!0,size:"small"},model:{value:e.addOrUpdateWarnRuleDialogForm.receivePeople,callback:function(t){e.$set(e.addOrUpdateWarnRuleDialogForm,"receivePeople",t)},expression:"addOrUpdateWarnRuleDialogForm.receivePeople"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-more"},on:{click:e.selectUsers},slot:"append"})],1)],1)],1),e._v(" "),a("select-uers",{attrs:{visible:e.visibleSelectUsers,type:-1==e.isEditRelation.id?"add":"edit",ids:e.selectedUsers},on:{selectCallback:e.selectCallback}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeDialog}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"small",loading:e.buttonLoading},on:{click:function(t){return e.submitForm("addOrUpdateWarnRuleDialogForm")}}},[e._v("保 存")])],1)],1)],1)},n=[],l={render:i,staticRenderFns:n};t.a=l},"0FCE":function(e,t,a){"use strict";function i(e){a("tCnf")}Object.defineProperty(t,"__esModule",{value:!0});var n=a("l1d7"),l=a("3TIu"),r=a("VU/8"),s=i,o=r(n.a,l.a,!1,s,null,null);t.default=o.exports},"2HRN":function(e,t,a){"use strict";function i(e){a("jFoT")}var n=a("i2ID"),l=a("TmEv"),r=a("VU/8"),s=i,o=r(n.a,l.a,!1,s,null,null);t.a=o.exports},"3TIu":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"warn-setting-section main-outer"},[a("el-row",{staticClass:"common-condition ar mb15"}),e._v(" "),a("el-row",{staticClass:"main-inner"},[a("div",{staticClass:"search_list"},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-button",{staticClass:"grey-btn",attrs:{size:"mini"},on:{click:function(t){return e.addWarnRule(-1)}}},[e._v("新建")]),e._v(" "),a("el-button",{staticClass:"grey-btn",attrs:{size:"mini",disabled:this.deleteSelection.length<=0},on:{click:e.deleteList}},[e._v("删除")])],1),e._v(" "),a("div",{staticStyle:{float:"right"}},[a("el-input",{staticStyle:{width:"330px"},attrs:{placeholder:"请输入告警任务名进行查询",size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getList(1)}},model:{value:e.alarmName,callback:function(t){e.alarmName=t},expression:"alarmName"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.getList(1)}}},[e._v("查询")])],1)],1)],1),e._v(" "),a("el-row",{staticClass:"mt20 warn-setting-content"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"100%"},on:{"selection-change":e.changeFun}},[a("template",{slot:"empty"},[a("div",{staticClass:"show-empty"},[e._v("\n            暂无数据，请先"),a("span",{staticClass:"redText",on:{click:function(t){return e.addWarnRule(-1)}}},[e._v(" 新建告警规则")])])]),e._v(" "),a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"alarmName",label:"告警任务名称","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"告警原因","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.alarmReasion?a("el-tag",{staticClass:"success-tag"},[e._v("成功")]):e._e(),e._v(" "),0==t.row.alarmReasion?a("el-tag",{staticClass:"error-tag"},[e._v("失败")]):e._e(),e._v(" "),2==t.row.alarmReasion?a("el-tag",{staticClass:"going-tag"},[e._v("成功/失败")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"告警方式","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.alarmMethod?a("span",[e._v("邮件")]):e._e(),e._v(" "),2==t.row.alarmMethod?a("span",[e._v("短信")]):e._e(),e._v(" "),3==t.row.alarmMethod?a("span",[e._v("邮件/短信")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"warnSwitch",label:"告警开关","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{on:{change:function(a){return e.changeSwitch(t.row.id,t.row.status)}},model:{value:t.row.status,callback:function(a){e.$set(t.row,"status",a)},expression:"scope.row.status"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"operate-btn",attrs:{type:"text"},on:{click:function(a){return e.addWarnRule(t.row.id)}}},[e._v("编辑")])]}}])})],2),e._v(" "),a("el-pagination",{staticClass:"ar mt15",attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("add-or-update-warn-rule-dialog",{attrs:{isEditRelation:e.isEditRelation,addOrUpdateWarnRuleDialogVisible:e.addOrUpdateWarnRuleDialogVisible},on:{addOrUpdateWarnRuleDialogVisibleEvent:e.updateDialogStatus}})],1)},n=[],l={render:i,staticRenderFns:n};t.a=l},"8toj":function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,".warn-setting-section{height:100%}.warn-setting-section .main-inner{height:calc(100% - 35px)}.warn-setting-section .main-inner .warn-setting-content{height:calc(100% - 125px)}.warn-setting-section .search_list{margin-top:10px}.warn-setting-section .search_list .search_title{display:inline-block;width:60px;text-align:right;margin-right:10px}.warn-setting-section .search_list .el-radio-button__inner{border:0}.warn-setting-section .search_list .el-radio-button__orig-radio:checked+.el-radio-button__inner{color:#3ba3f8;border:0;background:transparent;-webkit-box-shadow:none;-o-box-shadow:none;box-shadow:none}",""])},EOHd:function(e,t,a){var i=a("Y2Ze");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("551f80b0",i,!0,{})},OIfj:function(e,t,a){"use strict";var i=a("2HRN"),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};t.a={name:"add-or-update-warn-rule-dialog",components:{selectUers:i.a},props:["addOrUpdateWarnRuleDialogVisible","isEditRelation"],data:function(){return{buttonLoading:!1,addOrUpdateWarnRuleDialogForm:{alarmId:0,alarmName:"",alarmReasion:"",alarmMethod:"1",receivePeople:""},rules:{alarmName:[{min:1,max:128,required:!0,message:"最大长度为128个字符",trigger:"blur"}],alarmReasion:[{required:!0,message:"请至少选择一个",trigger:"change"}],alarmMethod:[{required:!0,message:"请至少选择一个",trigger:"change"}],receivePeople:[{required:!0,message:"请选择接收人"}]},visibleSelectUsers:!1,selectedUsers:[],allUser:[]}},methods:{getDataById:function(){var e=this;this.$urlApi.dispatchTask.getAlarmById({id:this.isEditRelation.id}).then(function(t){t.data&&(e.addOrUpdateWarnRuleDialogForm={alarmId:t.data.id,alarmName:t.data.alarmName,alarmReasion:t.data.alarmReasion+"",alarmMethod:t.data.alarmMethod+"",receivePeople:t.data.receivePeople.split(",").map(function(t){return e.allUser.find(function(e){return e.id==t}).username}).join(",")},e.selectedUsers=t.data.receivePeople.split(",").map(function(e){return+e}))})},closeDialog:function(){this.$emit("addOrUpdateWarnRuleDialogVisibleEvent",this.addOrUpdateWarnRuleDialogVisible),this.addOrUpdateWarnRuleDialogForm.alarmId=0,this.$refs.addOrUpdateWarnRuleDialogForm.resetFields(),this.resetData()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.buttonLoading=!0;var a=n({},t.addOrUpdateWarnRuleDialogForm);a.receivePeople=a.receivePeople.split(",").map(function(e){return t.allUser.find(function(t){return t.username===e}).id}).join(","),t.$urlApi.dispatchTask.saveUpdateAlarm(a).then(function(e){t.buttonLoading=!1,t.$toast("success","操作成功"),t.$refs.addOrUpdateWarnRuleDialogForm.resetFields(),t.addOrUpdateWarnRuleDialogForm.alarmId=0,t.$emit("addOrUpdateWarnRuleDialogVisibleEvent",1),t.resetData()}).catch(function(e){t.buttonLoading=!1})})},selectUsers:function(){this.visibleSelectUsers=!0},selectCallback:function(e){e&&(this.addOrUpdateWarnRuleDialogForm.receivePeople=e.map(function(e){return e.username}).join(","),this.selectedUsers=e.map(function(e){return e.id})),this.visibleSelectUsers=!1},open:function(){var e=this;this.$urlApi.dispatchTask.getUserList({pageNumber:1,pageSize:1e7}).then(function(t){e.allUser=t.data,-1!=e.isEditRelation.id&&e.getDataById()})},resetData:function(){this.addOrUpdateWarnRuleDialogForm.alarmId=0,this.addOrUpdateWarnRuleDialogForm.alarmName="",this.addOrUpdateWarnRuleDialogForm.alarmReasion="",this.addOrUpdateWarnRuleDialogForm.alarmMethod="1",this.addOrUpdateWarnRuleDialogForm.receivePeople="",this.visibleSelectUsers=!1,this.selectedUsers=[],this.allUser=[]}}}},OUNY:function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,".selectedUsers .content{height:300px}.selectedUsers .content .depart{float:left;width:250px;margin-right:30px;border:1px solid #dcdfe6;height:100%;padding:10px 20px;-webkit-box-sizing:border-box;box-sizing:border-box;overflow:auto}.selectedUsers .content .depart .title{font-size:14px;margin:10px 0}.selectedUsers .content .user{float:left;width:300px;border:1px solid #dcdfe6;height:100%;padding:10px 20px;-webkit-box-sizing:border-box;box-sizing:border-box;overflow:auto}.selectedUsers .content .user .title{font-size:14px;margin:10px 0}.selectedUsers .content .user .el-checkbox__label{font-size:12px}",""])},TmEv:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"selectedUsers",attrs:{width:"700px",title:"选择告警接收人",visible:e.visible,"close-on-click-modal":!1,"before-close":e.closeDialog,"append-to-body":""},on:{"update:visible":function(t){e.visible=t},open:e.open}},[a("div",{staticClass:"content"},[a("div",{staticClass:"depart"},[a("div",{staticClass:"title"},[e._v("部门列表")]),e._v(" "),a("el-tree",{ref:"tree",attrs:{"default-expand-all":!0,"highlight-current":"",data:e.departList,props:e.defaultProps,"node-key":"id","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick}})],1),e._v(" "),a("div",{staticClass:"user"},[a("div",{staticClass:"title"},[e._v("用户列表")]),e._v(" "),e.userList.length?a("el-checkbox",{staticStyle:{float:"left",width:"100%","margin-top":"5px"},attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]):e._e(),e._v(" "),e.userList.length?a("el-checkbox-group",{on:{change:e.handleCheckedCitiesChange},model:{value:e.selectData,callback:function(t){e.selectData=t},expression:"selectData"}},e._l(e.userList,function(t){return a("el-checkbox",{key:t.id,staticStyle:{float:"left",width:"100%","margin-top":"5px"},attrs:{label:t}},[e._v(e._s(t.username))])}),1):a("div",{staticStyle:{margin:"30px auto","font-szie":"12px","margin-left":"100px",color:"#909399"}},[e._v("暂无数据")])],1)]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeDialog}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"small",loading:e.buttonLoading},on:{click:function(t){return e.submitForm()}}},[e._v("保 存")])],1)])},n=[],l={render:i,staticRenderFns:n};t.a=l},Y2Ze:function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,".add-or-update-warn-rule-dialog-section .el-dialog__wrapper .el-dialog__body .el-form .el-form-item{margin-bottom:0!important}.add-or-update-warn-rule-dialog-section .el-dialog__wrapper .el-dialog__body .el-form .el-form-item:first-child .el-form-item__error,.add-or-update-warn-rule-dialog-section .el-dialog__wrapper .el-form-item__error{top:85%}.add-or-update-warn-rule-dialog-section .el-radio__input.is-checked .el-radio__inner{border-color:#3ba3f8;background:#3ba3f8}.add-or-update-warn-rule-dialog-section .el-radio__input.is-checked+.el-radio__label{color:#3ba3f8;font-size:12px}.add-or-update-warn-rule-dialog-section .el-radio__label{font-size:12px}",""])},i2ID:function(e,t,a){"use strict";t.a={name:"selected",props:["visible","type","ids"],data:function(){return{buttonLoading:!1,departList:[],userList:[],selectData:[],checkAll:!1,isIndeterminate:null,defaultProps:{children:"children",label:"name"}}},methods:{open:function(){this.getDepart()},getDepart:function(){var e=this;this.$urlApi.dispatchTask.getDepartment({}).then(function(t){e.departList=t.data,"add"!==e.type||e.ids.length?e.ids.length&&e.getUserById():e.$nextTick(function(){t.data[0]&&e.handleNodeClick(t.data[0])})})},getUserById:function(){var e=this;this.$urlApi.dispatchTask.getUserById({id:this.ids[0]}).then(function(t){var a={id:t.data.department};e.handleNodeClick(a,"save")})},clickDepart:function(e){},submitForm:function(){this.$emit("selectCallback",this.selectData),this.resetData()},closeDialog:function(){this.$emit("selectCallback"),this.resetData()},handleCheckAllChange:function(e){this.selectData=e?this.userList:[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(e){var t=e.length;this.checkAll=t===this.userList.length,this.isIndeterminate=t>0&&t<this.userList.length},handleNodeClick:function(e,t){var a=this;this.$refs.tree.setCurrentKey(e.id),this.isIndeterminate=null,this.checkAll=!1,this.selectData=[],this.$urlApi.dispatchTask.getDepartMentPeople({ids:e.id}).then(function(e){if(a.userList=e.data,a.ids.length&&"save"===t){var i=[];a.ids.forEach(function(e){i.push(a.userList.find(function(t){return t.id==e}))}),a.selectData=i,a.userList.length<=a.selectData.length?a.checkAll=!0:a.isIndeterminate=!0}})},resetData:function(){this.buttonLoading=!1,this.departList=[],this.userList=[],this.selectData=[],this.checkAll=!1,this.isIndeterminate=null}}}},jFoT:function(e,t,a){var i=a("OUNY");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("6dd67b6e",i,!0,{})},l1d7:function(e,t,a){"use strict";var i=a("lADe");t.a={name:"warn-setting",components:{AddOrUpdateWarnRuleDialog:i.a},data:function(){return{addOrUpdateWarnRuleDialogVisible:!1,isEditRelation:{currTime:(new Date).getTime(),id:""},alarmName:"",total:0,currentPage:1,pageLength:10,deleteSelection:[],tableData:[]}},methods:{getList:function(e,t){var a=this;e&&(this.currentPage=e);var i={start:(this.currentPage-1)*this.pageLength,length:this.pageLength,alarmName:this.alarmName};this.$urlApi.dispatchTask.queryAlarmList(i).then(function(e){e.data.forEach(function(e){1===e.status?e.status=!0:e.status=!1}),"delete"===t&&e.recordsFiltered%a.pageLength==0&&a.currentPage>1&&a.getList(e.recordsFiltered/a.pageLength),a.tableData=e.data,a.total=e.recordsFiltered})},handleSizeChange:function(e){this.pageLength=e,this.getList(1)},handleCurrentChange:function(e){this.currentPage=e,this.getList()},changeFun:function(e){this.deleteSelection=e},updateDialogStatus:function(e){this.addOrUpdateWarnRuleDialogVisible=!1,this.isEditRelation.id=-1,1===e&&this.getList()},addWarnRule:function(e){var t=(new Date).getTime();this.addOrUpdateWarnRuleDialogVisible=!0,this.isEditRelation.id=e,this.isEditRelation.currTime=t},deleteList:function(){var e=this,t=this.deleteSelection.map(function(e){return e.id}).join();this.$confirm("确认要删除吗","系统消息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",cancelButtonClass:"cancelButton",confirmButtonClass:"confirmButton",closeOnClickModal:!1}).then(function(){e.$urlApi.dispatchTask.deleteAlarm({id:t}).then(function(t){e.getList(0,"delete"),e.$toast("success","删除成功")})}).catch(function(){})},changeSwitch:function(e,t){var a=this;this.$urlApi.dispatchTask.checkIsOpen({alarmId:e,isOpen:t}).then(function(i){i.status?a.$urlApi.dispatchTask.openAlarm({alarmId:e,isOpen:t}).then(function(e){a.getList()}):a.$confirm("该报警规则已被引用，确定要关闭吗?","系统消息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",cancelButtonClass:"cancelButton",confirmButtonClass:"confirmButton",closeOnClickModal:!1}).then(function(){a.$urlApi.dispatchTask.openAlarm({alarmId:e,isOpen:t}).then(function(e){a.getList()})}).catch(function(){a.getList()})})}},mounted:function(){this.getList()}}},lADe:function(e,t,a){"use strict";function i(e){a("EOHd")}var n=a("OIfj"),l=a("/BV2"),r=a("VU/8"),s=i,o=r(n.a,l.a,!1,s,null,null);t.a=o.exports},tCnf:function(e,t,a){var i=a("8toj");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("4241501e",i,!0,{})}});